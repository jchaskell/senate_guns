{
    "collab_server" : "",
    "contents" : "#In this file, I put together all of the Senate speech data and merge in the ideology data\n#I also subset China speeches and do some preliminary looking at the data\n\nlibrary(ggplot2)\nlibrary(stringr)\nlibrary(stringi)\nlibrary(dplyr)\nlibrary(readr)\nlibrary(readxl)\nlibrary(car)\n\n#old data\nload(file = \"congress/cong_speeches/pre06.RData\") #old data\nload(file = \"congress/temp/post2006.RData\") \n\n#add in congress to new data - fix variables so they match\ndata <- data[,c(\"name\", \"congress\", \"year\", \"month\", \"day\", \"state\", \"speech\")]\n\npre06 <- pre06 %>% rename(day = date)\npre06 <- pre06[,c(\"name\", \"congress\", \"year\", \"month\", \"day\", \"state\", \"speech\")]\n\nall_senate <- rbind(data, pre06)\n\nall_senate <- all_senate %>% filter(year >= 1989)\n\nsave(all_senate, file = \"congress/cong_speeches/all_senate.RData\")\nload(file = \"congress/cong_speeches/all_senate.RData\")\n# \n# #graph of China over time as % of speeches and as total # of speeches\n# all_senate$date_month <- paste(all_senate$year, ifelse(all_senate$month >= 10, all_senate$month, paste0(0, all_senate$month)), \"01\", sep = \"-\") #puts fake date in to use date scale\n# all_senate$date_month <- as.Date(all_senate$date_month, format = \"%Y-%m-%d\")\n# \n# #create summary data set with number of China speeches and percent of China speeches\n# china_graphs <- all_senate %>% group_by(date_month) %>% \n#         summarise(china_count = sum(china),\n#                   china_percent = sum(china)/length(china))\n# \n# library(scales)\n# #spikes:\n# # 7/1991 - first vote on yearly review of MFN status\n# # 9/2000 - PNTR vote\n# # 10/2011 - Currency Exchange Rate Oversight Reform Act \n# \n# #set y values for points\n# y_91 <- as.numeric(china_graphs[which(china_graphs$date_month == as.Date(\"1991-07-01\")), \"china_count\"])\n# y_00 <- as.numeric(china_graphs[which(china_graphs$date_month == as.Date(\"2000-09-01\")), \"china_count\"])\n# y_11 <- as.numeric(china_graphs[which(china_graphs$date_month == as.Date(\"2011-10-01\")), \"china_count\"])\n# \n# p <- ggplot(china_graphs, aes(x = date_month, y = china_count)) + geom_line(colour = \"red\", size = 1) + scale_x_date() + ggtitle(\"Number of China speeches\") + ylab(\"Number of speeches\") + xlab(\"\")\n# p <- p +  geom_segment(aes(x = as.Date(\"1991-07-01\"), y = y_91, xend = as.Date(\"1992-02-01\"), yend = y_91)) + \n#         geom_segment(aes(x = as.Date(\"2000-09-01\"), y = y_00, xend = as.Date(\"2001-04-01\"), yend = y_00)) +\n#         geom_segment(aes(x = as.Date(\"2011-10-01\"), y = y_11, xend = as.Date(\"2011-04-01\"), yend = y_11)) + \n#         annotate(\"text\", x = as.Date(\"1994-05-01\"), y = y_91+1, label = \"Vote to link MFN to human rights\") + \n#         annotate(\"text\", x = as.Date(\"2002-08-01\"), y = y_00+1, label = \"Vote to grant PNTR\") +\n#         annotate(\"text\", x = as.Date(\"2009-01-01\"), y = y_11+1, label = \"Currency Oversight Reform Act\")\n#         \n# ggsave(p, file = \"congress/output/china_speeches.png\")\n\n\n########################################################################################\n# Fixing up names of senators and their states using DW Nominate data\n\nload(file = \"congress/cong_speeches/all_senate.RData\")\n\n#Merge in DWNom data - data comes from: http://voteview.com/dwnomin.htm\ncols <- c(\"congress\", \"icspr\", \"state.code\", \"district\", \"state.dw\", \"party\", \"name\", \"firstd\", \"secondd\", \"firstd_se\", \"secondd_se\", \"correlation\", \"loglik\", \"votes\", \"class_errors\", \"mean_prob\")\nsenate <- read_excel(\"congress/input/dwnom/dwnom_senate.xlsx\", col_names = cols)\n\nsenate <- senate %>% filter(congress >= 101) %>% select(congress, state.code, state.dw, party, name, dwnom = firstd)\n\n#Create a list of unique people-congress sets\nsenators_list <- all_senate %>% select(name, congress, state_speech = state) %>% distinct(name, congress)\n# senators_list$name <- toupper(senators_list$name)\n# senators_list$speech_exists <- 1\n# \n# s <- merge(senators_list, senate, by = c(\"name\", \"congress\"), all.x = T, all.y = T)\n# \n# #print this to a file to look at matches\n# write.csv(s, file = \"congress/temp/senators_match.csv\")\n# \n# \n# #Checks to see \n# f <- all_senate %>% filter(name == \"Bennett\" & congress == 112)\n# f <- all_senate %>% filter(name == \"Biden\" & congress == 111)\n# f <- all_senate %>% filter(name == \"Booker\" & congress == 113)\n# f <- all_senate %>% filter(name == \"Chafee\" & congress == 106)\n# f <- all_senate %>% filter(name == \"Clinton\" & congress == 111)\n# f <- all_senate %>% filter(name == \"Conrad\" & congress == 113)\n# f <- all_senate %>% filter(name == \"Frahm\" & congress == 104)\n# f <- all_senate %>% filter(name == \"Huchison\" & congress == 103)\n# f <- all_senate %>% filter(name == \"Johnston\" & congress == 104)\n# f <- all_senate %>% filter(name == \"Salazar\" & congress == 111)\n# f <- all_senate %>% filter(name == \"Bingman\" & congress == 110)\n\n#Easy name changes\n#2006 and before, names are lower case; after 2006, first letter is capitalized\nall_senate1 <- all_senate %>% filter(year <= 2006)\nall_senate2 <- all_senate %>% filter(year > 2006)\nall_senate1$name <- ifelse(all_senate1$name == \"adams\" & all_senate1$congress == \"101\", \"adams broc\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"Barrasso\" & (all_senate2$congress == \"112\" | all_senate2$congress == \"113\"), \"Barasso\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"baucus\" & all_senate1$congress == \"101\", \"baucus max\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"bentsen\" & all_senate1$congress == \"101\", \"bentsen ll\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"biden\" & all_senate1$congress == \"101\", \"biden jose\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"bingaman\" & all_senate1$congress == \"101\", \"bingaman j\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"bond\" & all_senate1$congress == \"101\", \"bond chris\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"boren\" & all_senate1$congress == \"101\", \"boren davi\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"bradley\" & all_senate1$congress == \"101\", \"bradley wi\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"breaux\" & all_senate1$congress == \"101\", \"breaux joh\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"brown\" & all_senate1$state == \"co\", \"brown hank\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"bryan\", \"bryan rich\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"bumpers\" & all_senate1$congress == \"101\", \"bumpers da\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"burdick\" & all_senate1$congress == \"101\", \"burdick qu\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"burdick\" & all_senate1$congress == \"102\", \"burdick2\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"burns\" & all_senate1$congress == \"101\", \"burns conr\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"byrd\", \"byrd rober\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"Byrd\", \"Byrd Rober\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"chafee\" & all_senate1$congress == \"101\", \"chafee joh\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"chafee\" & all_senate1$congress == \"106\", \"chafeel\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"CHIESA_Chiesa\", \"Chiesa\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"coats\" & all_senate1$congress == \"101\", \"coats dani\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"cochran\" & all_senate1$congress == \"101\", \"cochran th\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"cohen\" & all_senate1$congress == \"101\", \"cohen will\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"conrad\" & all_senate1$congress == \"101\", \"conrad ken\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"COWAN_Cowan\", \"Cowan\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"cranston\" & all_senate1$congress == \"101\", \"cranston a\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"CRUZ_Cruz\", \"Cruz\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"damato\", ifelse(all_senate1$congress == \"101\", \"d'amato al\", \"D'amato\"), all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"danforth\" & all_senate1$congress == \"101\", \"danforth j\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"daschle\" & all_senate1$congress == \"101\", \"daschle th\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"dixon\", \"dixon alan\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"dodd\" & all_senate1$congress == \"101\", \"dodd chris\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"dole\" & all_senate1$congress == \"101\", \"dole bob\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"domenici\" & all_senate1$congress == \"101\", \"domenici p\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"exon\" & all_senate1$congress == \"101\", \"exon john\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"FISCHER_Fischer\", \"Fischer\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"ford\", \"ford wende\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"fowler\" & all_senate1$congress == \"101\", \"fowler wyc\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"garn\" & all_senate1$congress == \"101\", \"garn jake\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"glenn\" & all_senate1$congress == \"101\", \"glenn john\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"gore\" & all_senate1$congress == \"101\", \"gore alber\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"gorton\" & all_senate1$congress == \"101\", \"gorton sla\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"graham\" & all_senate1$state == \"fl\", \"graham bob\", all_senate1$name)\n\nall_senate1$name <- ifelse(all_senate1$name == \"gramm\" & all_senate1$congress != \"101\", \"gramm phil\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"gramm\" & all_senate1$congress == \"101\", \"gramm will\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"grassley\" & all_senate1$congress == \"101\", \"grassley c\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"harkin\" & all_senate1$congress == \"101\", \"harkin tom\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"hatch\" & all_senate1$congress == \"101\", \"hatch orri\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"hatfield\" & all_senate1$congress == \"101\", \"hatfield m\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"heflin\" & all_senate1$congress == \"101\", \"heflin how\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"HEINRICH_Heinrich\", \"Heinrich\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"heinz\" & all_senate1$congress == \"101\", \"heinz h.j\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"HEITKAMP_Heitkamp\", \"Heitkamp\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"helms\" & all_senate1$congress == \"101\", \"helms jess\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"hollings\" & all_senate1$congress == \"101\", \"hollings e\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"humphrey\" & all_senate1$congress == \"101\", \"humphrey g\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"inouye\" & all_senate1$congress == \"101\", \"inouye dan\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"jeffords\" & all_senate1$congress == \"101\", \"jeffords j\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"johnston\", ifelse(all_senate1$congress == \"101\", \"johnston j\", \"johnston b\"), all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"KAINE_Kaine\", \"Kaine\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"kasten\" & all_senate1$congress == \"101\", \"kasten rob\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"kennedy\", \"kennedy ed\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"kerrey\", \"kerrey rob\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"kerry\", \"kerry john\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"Kennedy\", \"Kennedy Ed\", all_senate2$name)\nall_senate2$name <- ifelse(all_senate2$name == \"Kerry\", \"Kerry John\", all_senate2$name)\nall_senate2$name <- ifelse(all_senate2$name == \"KING_King\", \"King\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"kohl\" & all_senate1$congress == \"101\", \"kohl herbe\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"leahy\" & all_senate1$congress == \"101\", \"leahy patr\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"levin\", \"levin carl\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"Levin\", \"Levin Carl\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"lott\" & all_senate1$congress == \"101\", \"lott trent\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"lugar\" & all_senate1$congress == \"101\", \"lugar rich\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"mack\" & all_senate1$congress == \"101\", \"mack conni\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"mccain\" & all_senate1$congress == \"101\", \"mccain joh\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"mcclure\" & all_senate1$congress == \"101\", \"mcclure ja\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"mcconnell\" & all_senate1$congress == \"101\", \"mcconnell j\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"mikulski\" & all_senate1$congress == \"101\", \"mikulski b\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"mitchell\", \"mitchell g\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"moseleybraun\", \"moseley-bra\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"moynihan\" & all_senate1$congress == \"101\", \"moynihan d\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"nelson\" & all_senate1$state == \"fl\" & all_senate1$congress != \"109\", \"nelson cla\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"nelson\" & all_senate1$state == \"ne\", \"nelson ben\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"nickles\", \"nickles do\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"nunn\" & all_senate1$congress == \"101\", \"nunn Sam\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"packwood\" & all_senate1$congress == \"101\", \"packwood r\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"pell\" & all_senate1$congress == \"101\", \"pell claib\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"pressler\" & all_senate1$congress == \"101\", \"pressler l\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"pryor\" & all_senate1$congress == \"101\", \"pryor davi\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"reid\" & all_senate1$congress == \"101\", \"reid harry\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"riegle\" & all_senate1$congress == \"101\", \"riegle don\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"robb\" & all_senate1$congress == \"101\", \"robb charl\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"roth\", \"roth willi\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"rudman\" & all_senate1$congress == \"101\", \"rudman war\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"sanford\" & all_senate1$congress == \"101\", \"sanford te\", all_senate1$name)        \nall_senate1$name <- ifelse(all_senate1$name == \"sarbanes\" & all_senate1$congress == \"101\", \"sarbanes p\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"sasser\" & all_senate1$congress == \"101\", \"sasser jam\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"SCHATZ_Schatz\", \"Schatz\", all_senate2$name)\nall_senate2$name <- ifelse(all_senate2$name == \"SCOTT_Scott\", \"Scott\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"shelby\" & all_senate1$congress == \"101\", \"shelby ric\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"simon\" & all_senate1$congress == \"101\", \"simon paul\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"simpson\" & all_senate1$congress == \"101\", \"simpson al\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"smith\" & all_senate1$state == \"nh\", \"smith robe\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"smith\" & all_senate1$state == \"or\", \"smith gord\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"Smith\", \"Smith Gord\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"specter\" & all_senate1$congress == \"101\", \"specter ar\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"stevens\" & all_senate1$congress == \"101\", \"stevens th\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"symms\" & all_senate1$congress == \"101\", \"symms stev\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"thurmond\" & all_senate1$congress == \"101\", \"thurmond j\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"warner\" & all_senate1$congress == \"101\", \"warner joh\", all_senate1$name)\nall_senate2$name <- ifelse(all_senate2$name == \"WARREN_Warren\", \"Warren\", all_senate2$name)\nall_senate1$name <- ifelse(all_senate1$name == \"wallop\" & all_senate1$congress == \"101\", \"wallop mal\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"wilson\" & all_senate1$congress == \"101\", \"wilson pet\", all_senate1$name)\nall_senate1$name <- ifelse(all_senate1$name == \"wirth\" & all_senate1$congress == \"101\", \"wirth timo\", all_senate1$name)\n\nall_senate1$congress <- as.numeric(all_senate1$congress)\nall_senate2$congress <- as.numeric(all_senate2$congress)\nall_senate <- rbind(all_senate1, all_senate2)\n\n#to match, I am getting rid of space between names\nsenate$name <- str_replace_all(senate$name, \"  \", \"\")\nall_senate$name <- str_replace_all(all_senate$name, \" \", \"\")\nsenate$name <- str_replace_all(senate$name, \"  \", \"\")\nsenate$name <- ifelse(senate$name == \"CHAFEE\" & senate$congress == 106 & senate$dwnom < 0, \"CHAFEEL\", senate$name)\nsenate$name <- ifelse(senate$name == \"MCCONNELL J\", \"MCCONNELLJ\", senate$name)\nall_senate$name <- toupper(all_senate$name)\nall_senate$name <- ifelse(all_senate$name == \"BINGMAN\", \"BINGAMAN\", all_senate$name)\nall_senate$name <- ifelse(all_senate$name == \"LIEBERMANN\", \"LIEBERMAN\", all_senate$name)\nall_senate$name <- ifelse(all_senate$name == \"HEINZH.J\" & all_senate$congress == 101, \"HEINZH. J\", all_senate$name)\nall_senate$name <- ifelse(all_senate$name == \"KERRYJOHN\" & all_senate$congress == 101, \"KERRY JOHN\", all_senate$name)\nall_senate$name <- ifelse(all_senate$name == \"LOTTTRENT\" & all_senate$congress == 101, \"LOTT TRENT\", all_senate$name)\n\n#Repeat names etc\n\n\n#for repeat names\n#states\nfix <- all_senate %>% filter(name == \"BROWN_MASSACHUSETTS\" | name == \"BROWN_OHIO\" | name == \"JOHNSON_SOUTH_DAKOTA\" | name == \"JOHNSON_WISCONSIN\" | (name == \"KIRK\" & congress == 111) | name == \"NELSON_NEBRASKA\" | name == \"NELSON_FLORIDA\" | name == \"UDALL_COLORADO\" | name == \"UDALL_NEW_MEXICO\")\nfix$state <- ifelse(fix$name == \"BROWN_MASSACHUSETTS\", \"MASSACH\", ifelse(fix$name == \"BROWN_OHIO\", \"OHIO\", ifelse(fix$name == \"JOHNSON_SOUTH_DAKOTA\", \"SOUTH D\", ifelse(fix$name == \"JOHNSON_WISCONSIN\", \"WISCONS\", ifelse(fix$name == \"NELSON_NEBRASKA\", \"NEBRASK\", ifelse(fix$name == \"NELSON_FLORIDA\", \"FLORIDA\", ifelse(fix$name == \"UDALL_COLORADO\", \"COLORAD\", ifelse(fix$name == \"UDALL_NEW_MEXICO\", \"NEW MEX\", fix$state))))))))\n\n#fix kirk - Rep from Illinois if after 2/2010; otherwise, Dem from MA \nfix$state <- ifelse(fix$name == \"KIRK\", ifelse(fix$year == 2009, \"MASSACH\", ifelse(fix$year > 2010, \"ILLINOI\", ifelse(fix$month <= 2, \"MASSACH\", \"ILLINOI\"))), fix$state)\n\n#names\nfix$name <- ifelse(fix$name == \"BROWN_MASSACHUSETTS\", \"BROWN\", ifelse(fix$name == \"BROWN_OHIO\", \"BROWN\", ifelse(fix$name == \"JOHNSON_SOUTH_DAKOTA\", \"JOHNSON\", ifelse(fix$name == \"JOHNSON_WISCONSIN\", \"JOHNSON\", ifelse(fix$name == \"NELSON_NEBRASKA\", \"NELSONBEN\", ifelse(fix$name == \"NELSON_FLORIDA\", \"NELSON\", ifelse(fix$name == \"UDALL_COLORADO\", \"UDALL\", ifelse(fix$name == \"UDALL_NEW_MEXICO\", \"UDALL\", fix$name))))))))\n\n#merge\nfix <- fix %>% rename(state.dw = state)\nfix2 <- merge(fix, senate, by = c(\"name\", \"state.dw\", \"congress\"), all.x = T)\n\n#merge the rest of the speeches:\nall_senate2 <- merge(all_senate, senate, by = c(\"name\", \"congress\"), all.x = T, all.y = T)\nall_senate2 <- all_senate2 %>% select(name, state.dw, congress, year, month, day, speech, state.code, party, dwnom)\nall_senate2 <- rbind(all_senate2, fix2)\n\n#Ideologies, etc to fix after merge\nall_senate2$state.dw <- ifelse(all_senate2$name == \"BARKLEY\", \"MINNESO\", all_senate2$state.dw)\nall_senate2$state.code <- ifelse(all_senate2$name == \"BARKLEY\", 33, all_senate2$state.code)\nall_senate2$party <- ifelse(all_senate2$name == \"BARKLEY\", 328, all_senate2$party)\n\nall_senate2$state.dw <- ifelse(all_senate2$name == \"BENNETT\" & all_senate2$congress == 112, \"UTAH\", all_senate2$state.dw)\nall_senate2$state.code <- ifelse(all_senate2$name == \"BENNETT\" & all_senate2$congress == 112, 67, all_senate2$state.code)\nall_senate2$party <- ifelse(all_senate2$name == \"BENNETT\" & all_senate2$congress == 112, 200, all_senate2$party)\nall_senate2$dwnom <- ifelse(all_senate2$name == \"BENNETT\" & all_senate2$congress == 112, all_senate2[which(all_senate2$name == \"BENNETT\" & all_senate2$congress == 111), \"dwnom\"], all_senate2$dwnom)\n\nall_senate2$state.dw <- ifelse(all_senate2$name == \"BIDEN\" & all_senate2$congress == 111, \"DELAWAR\", all_senate2$state.dw)\nall_senate2$state.code <- ifelse(all_senate2$name == \"BIDEN\" & all_senate2$congress == 111, 67, all_senate2$state.code)\nall_senate2$party <- ifelse(all_senate2$name == \"BIDEN\" & all_senate2$congress == 111, 100, all_senate2$party)\nall_senate2$dwnom <- ifelse(all_senate2$name == \"BIDEN\" & all_senate2$congress == 111, all_senate2[which(all_senate2$name == \"BIDEN\" & all_senate2$congress == 110), \"dwnom\"], all_senate2$dwnom)\n\nall_senate2$state.dw <- ifelse(all_senate2$name == \"CLINTON\" & all_senate2$congress == 111, \"NEW YOR\", all_senate2$state.dw)\nall_senate2$state.code <- ifelse(all_senate2$name == \"CLINTON\" & all_senate2$congress == 111, 13, all_senate2$state.code)\nall_senate2$party <- ifelse(all_senate2$name == \"CLINTON\" & all_senate2$congress == 111, 100, all_senate2$party)\nall_senate2$dwnom <- ifelse(all_senate2$name == \"CLINTON\" & all_senate2$congress == 111, all_senate2[which(all_senate2$name == \"CLINTON\" & all_senate2$congress == 110), \"dwnom\"], all_senate2$dwnom)\n\nall_senate2$state.dw <- ifelse(all_senate2$name == \"CONRAD\" & all_senate2$congress == 113, \"NORTH D\", all_senate2$state.dw)\nall_senate2$state.code <- ifelse(all_senate2$name == \"CONRAD\" & all_senate2$congress == 113, 36, all_senate2$state.code)\nall_senate2$party <- ifelse(all_senate2$name == \"CONRAD\" & all_senate2$congress == 113, 100, all_senate2$party)\nall_senate2$dwnom <- ifelse(all_senate2$name == \"CONRAD\" & all_senate2$congress == 113, all_senate2[which(all_senate2$name == \"CONRAD\" & all_senate2$congress == 112), \"dwnom\"], all_senate2$dwnom)\n\nall_senate2$state.dw <- ifelse(all_senate2$name == \"INHOFE\" & all_senate2$congress == 103, \"OKLAHOM\", all_senate2$state.dw)\nall_senate2$state.code <- ifelse(all_senate2$name == \"INHOFE\" & all_senate2$congress == 103, 53, all_senate2$state.code)\nall_senate2$party <- ifelse(all_senate2$name == \"INHOFE\" & all_senate2$congress == 103, 200, all_senate2$party)\nall_senate2$dwnom <- ifelse(all_senate2$name == \"INHOFE\" & all_senate2$congress == 103, all_senate2[which(all_senate2$name == \"INHOFE\" & all_senate2$congress == 104), \"dwnom\"], all_senate2$dwnom)\n\nall_senate2$state.dw <- ifelse(all_senate2$name == \"KENNEDYED\" & all_senate2$congress == 111, \"MASSACH\", all_senate2$state.dw)\nall_senate2$state.code <- ifelse(all_senate2$name == \"KENNEDYED\" & all_senate2$congress == 111, 3, all_senate2$state.code)\nall_senate2$party <- ifelse(all_senate2$name == \"KENNEDYED\" & all_senate2$congress == 111, 100, all_senate2$party)\nall_senate2$dwnom <- ifelse(all_senate2$name == \"KENNEDYED\" & all_senate2$congress == 111, all_senate2[which(all_senate2$name == \"KENNEDYED\" & all_senate2$congress == 110), \"dwnom\"], all_senate2$dwnom)\n\nall_senate2$state.dw <- ifelse(all_senate2$name == \"KERRYJOHN\" & all_senate2$congress == 113, \"MASSACH\", all_senate2$state.dw)\nall_senate2$state.code <- ifelse(all_senate2$name == \"KERRYJOHN\" & all_senate2$congress == 113, 3, all_senate2$state.code)\nall_senate2$party <- ifelse(all_senate2$name == \"KERRYJOHN\" & all_senate2$congress == 113, 100, all_senate2$party)\nall_senate2$dwnom <- ifelse(all_senate2$name == \"KERRYJOHN\" & all_senate2$congress == 113, all_senate2[which(all_senate2$name == \"KERRYJOHN\" & all_senate2$congress == 112), \"dwnom\"], all_senate2$dwnom)\n\nall_senate2$state.dw <- ifelse(all_senate2$name == \"SALAZAR\" & all_senate2$congress == 111, \"COLORAD\", all_senate2$state.dw)\nall_senate2$state.code <- ifelse(all_senate2$name == \"SALAZAR\" & all_senate2$congress == 111, 62, all_senate2$state.code)\nall_senate2$party <- ifelse(all_senate2$name == \"SALAZAR\" & all_senate2$congress == 111, 100, all_senate2$party)\nall_senate2$dwnom <- ifelse(all_senate2$name == \"SALAZAR\" & all_senate2$congress == 111, all_senate2[which(all_senate2$name == \"SALAZAR\" & all_senate2$congress == 110), \"dwnom\"], all_senate2$dwnom)\n\n#test and make sure everything is matching up\nsenators_list <- all_senate2 %>% group_by(name, state.dw, congress) %>% summarize(dw = mean(dwnom)) #FINISHED\n\n#get rid of rows that don't have dwnom or a speech\nall_senate2 <- all_senate2 %>% filter(is.na(dwnom) == F & speech != \"\")\n\n#Fix party identifiers\nall_senate2$party <- recode(all_senate2$party, \"100 = 'Democrat'; 200 = 'Republican'; 328 = 'Independent'\")\n\nsave(all_senate2, file = \"congress/cong_speeches/all_senate2.RData\")\n\n#mark speeches as China or not \n# words <- c(\"China\", \"Chinese\", \"Beijing\", \"China's\", \"Beijing's\", \"Taiwan\", \"Taiwan's\") #words to mark a speech as including China or not\n# all_senate2$china <- ifelse(str_detect(all_senate2$speech, words[1]) | str_detect(all_senate2$speech, words[2]) | str_detect(all_senate2$speech, words[3]) | str_detect(all_senate2$speech, words[4]) | str_detect(all_senate2$speech, words[5]) | str_detect(all_senate2$speech, words[6]) | str_detect(all_senate2$speech, words[7]), 1, 0)\n# \n# #save a version with only China speeches\n# china <- all_senate2 %>% filter(china == 1)\n# china$id <- seq(1, dim(china)[1])\n# save(china, file = \"congress/cong_speeches/china_senate_speeches.RData\")\n\n#Counts for descriptive chapter\nload(file = \"congress/cong_speeches/all_senate2.RData\")\nload(file = \"congress/cong_speeches/china_senate_speeches.RData\")\n\n\n#Change names so they are the same person across years...\nsenators_list <- all_senate2 %>% select(name, congress, state.dw, dwnom) %>% distinct(name, congress, state.dw)\n#write to file to look at names - I am adding complete names for all senators there\n# write.csv(senators_list, file = \"congress/temp/senators_fix_names.csv\")\n\nfix <- read.csv(file = \"congress/input/senators_fix_names.csv\", stringsAsFactors = F)\nall_senate3 <- merge(all_senate2, fix[,c(-1, -5)], by = c(\"name\", \"congress\", \"state.dw\"), all.x = T)\n\n#get rid of duplicates\nall_senate3 <- all_senate3[!duplicated(all_senate3),]\nsave(all_senate3, file = \"congress/cong_speeches/all_senate3.RData\")\n\nall_senate2$china <- ifelse(str_detect(all_senate2$speech, words[1]) | str_detect(all_senate2$speech, words[2]) | str_detect(all_senate2$speech, words[3]) | str_detect(all_senate2$speech, words[4]) | str_detect(all_senate2$speech, words[5]) | str_detect(all_senate2$speech, words[6]) | str_detect(all_senate2$speech, words[7]), 1, 0)\nchina <- all_senate2 %>% filter(china == 1)\nsave(china, c)\n\n#counts for all \ndim(all_senate2)[1]\ndim(china)[1]\nlength(unique(all_senate2$name_fix))\nlength(unique(china$name_fix))\n\n#graph of speeches by party\nchina$date_month <- paste(china$year, ifelse(china$month >= 10, china$month, paste0(0, china$month)), \"01\", sep = \"-\") #puts fake date in to use date scale\nchina$date_month <- as.Date(china$date_month, format = \"%Y-%m-%d\")\nchina_graphs <- china %>% group_by(date_month, party) %>% \n        summarise(china_count = sum(china),\n                  china_percent = sum(china)/length(china))\n\nlibrary(scales)\np <- ggplot(china_graphs, aes(x = date_month, y = china_count, group = party)) + geom_line(aes(colour = party)) + scale_x_date() + ggtitle(\"Number of China speeches\") + ylab(\"Number of speeches\") + xlab(\"\")\n\n\nggsave(p, file = \"congress/output/china_speeches_byparty.png\")\n#Nothing too interesting in terms of differences\n\n#Counts number of times the different words are mentioned\n#10975\ncount_words <- str_count(china$speech, words[1]) + str_count(china$speech, words[2]) + str_count(china$speech, words[3]) + str_count(china$speech, words[4]) + str_count(china$speech, words[5]) + str_count(china$speech, words[6]) + str_count(china$speech, words[7])\nsum(count_words) #72,210\nsum(str_count(china$speech, words[1])) #42,634\n\n#Compare China to other countries\n#total percent of speeches\n10617/ 690435  #15%\n\njapan_w <- c(\"Japan\", \"Japanese\", \"Japan's\", \"Tokyo\")\nmexico_w <- c(\"Mexico\", \"Mexican\", \"Mexico's\")\nuk_w <- c(\"Britain\", \"British\", \"United Kingdom\", \"London\", \"England\", \"UK\")\niraq_w <- c(\"Iraq\", \"Baghdad\")\nabortion_w <- c(\"abortion\")\neconomy_w <- c(\"economy\", \"economic\")\n\njapan <- ifelse(str_detect(all_senate2$speech, japan_w[1]) | str_detect(all_senate2$speech, japan_w[2]) | str_detect(all_senate2$speech, japan_w[3]) | str_detect(all_senate2$speech, japan_w[4]), 1, 0)\nuk <- ifelse(str_detect(all_senate2$speech, uk_w[1]) | str_detect(all_senate2$speech, uk_w[2]) | str_detect(all_senate2$speech, uk_w[3]) | str_detect(all_senate2$speech, uk_w[4]) | str_detect(all_senate2$speech, uk_w[5]) | str_detect(all_senate2$speech, uk_w[6]), 1, 0)\nmexico <- ifelse(str_detect(all_senate2$speech, mexico_w[1]) | str_detect(all_senate2$speech, mexico_w[2]) | str_detect(all_senate2$speech, mexico_w[3]), 1, 0)\nabortion <- ifelse(str_detect(all_senate2$speech, abortion_w[1]), 1, 0)\nenvironment <- ifelse(str_detect(all_senate2$speech, \"environment\"), 1, 0)\neconomy <- ifelse(str_detect(all_senate2$speech, economy_w[1]) | str_detect(all_senate2$speech, economy_w[2]), 1, 0)\niraq <- ifelse(str_detect(all_senate2$speech, iraq_w[1]) | str_detect(all_senate2$speech, iraq_w[2]), 1, 0)\n\n\nsum(japan)/ 690435 \nsum(uk)/ 690435\nsum(mexico)/ 690435\nsum(iraq)/ 690435\nsum(abortion)/ 690435\nsum(environment)/ 690435\nsum(economy)/ 690435\n\n#Clean press releases\nload(file = \"congress/cong_pr/senate.RData\")\n\n#merge with dw nominate\ncols <- c(\"congress\", \"icspr\", \"state.code\", \"district\", \"state.dw\", \"party\", \"name\", \"firstd\", \"secondd\", \"firstd_se\", \"secondd_se\", \"correlation\", \"loglik\", \"votes\", \"class_errors\", \"mean_prob\")\nsenate <- read_excel(\"congress/input/dwnom/dwnom_senate.xlsx\", col_names = cols)\n\npress_releases$year <- ifelse(press_releases$year == 202008, 2008, press_releases$year)\n\nsenate <- senate %>% filter(congress == 109 | congress == 110) %>% select(congress, state.code, state.dw, party, name, dwnom = firstd)\n\npress_releases$congress <- ifelse(press_releases$year == 2004, 108, ifelse(press_releases$year >= 2007, 110, 109))\npress_releases <- press_releases %>% filter(congress >= 109)\n\n#test of merge\npress_releases$name <- toupper(press_releases$name)\npress_releases2 <- press_releases %>% group_by(name, congress) %>% summarise(count = length(name))\na <- merge(press_releases2, senate, by = c(\"name\", \"congress\"), all.x = T, all.y = T)\nwrite.csv(a, file = \"congress/temp/pr_list.csv\")\n\n#fix of names\npress_releases$name <- ifelse(press_releases$name == \"BENNELSON\", \"NELSON  BEN\", press_releases$name)\npress_releases$name <- ifelse(press_releases$name == \"BILLNELSON\", \"NELSON\", press_releases$name)\npress_releases$name <- ifelse(press_releases$name == \"BYRD\", \"BYRD  ROBER\", press_releases$name)\npress_releases$name <- ifelse(press_releases$name == \"KENNEDY\", \"KENNEDY  ED\", press_releases$name)\npress_releases$name <- ifelse(press_releases$name == \"KERRY\", \"KERRY  JOHN\", press_releases$name)\npress_releases$name <- ifelse(press_releases$name == \"LEVIN\", \"LEVIN  CARL\", press_releases$name)\npress_releases$name <- ifelse(press_releases$name == \"SMITH\", \"SMITH  GORD\", press_releases$name)\n#Missing Wicker from Mississippi\n\npr <- merge(press_releases, senate, by = c(\"name\", \"congress\"), all.x = T)\n\n#get China press releases\nwords <- c(\"China\", \"Chinese\", \"Beijing\", \"Taiwan\", \"CHINA\", \"CHINESE\", \"BEIJING\", \"TAIWAN\") #words to mark a speech as including China or not\n\npr$china <- ifelse(str_detect(pr$press_release, words[1]) | str_detect(pr$press_release, words[2]) | str_detect(pr$press_release, words[3]) | str_detect(pr$press_release, words[4]) | str_detect(pr$press_release, words[5]) | str_detect(pr$press_release, words[6]) | str_detect(pr$press_release, words[7]) | str_detect(pr$press_release, words[8]), 1, 0)\n\n#Need to get rid of terms that are common by senator (in more ??? % of press releases by senator) because these reflect stylistic choices; eventually want to use the percent and method that Justin uses\n\npr_china <- pr %>% filter(china == 1)\n\n#merge with speeches\nload(file = \"congress/cong_speeches/china_senate_speeches.RData\")\nclass(china$name_fix)\nchina$name_fix <- as.character(china$name_fix)\nload(file = \"congress/cong_speeches/all_senate2.RData\")\nall_senate2$name_fix <- as.character(all_senate2$name_fix)\n\n#first I match to get the name fixes from the speech data frame\nfix <- all_senate2 %>% filter(congress == 109 | congress == 110) %>% select(congress, name, name_fix) %>% distinct(congress, name, name_fix)\n\npr_china$name <- gsub(\"\\\\s\", \"\", pr_china$name)\n\npr_china <- merge(pr_china, fix, by = c(\"congress\", \"name\"), all.x = T)\npr_china$name_fix <- ifelse(is.na(pr_china$name_fix) == T, \"Nelson, Ben\", pr_china$name_fix)\n\nchina <- china[,-13]\nchina$type <- \"speech\"\npr_china <- pr_china %>% rename(speech = press_release)\npr_china$type <- \"press release\"\npr_china <- pr_china[,colnames(china)]\n\nchina$name_fix <- as.character(china$name_fix)\nall_china <- rbind(china, pr_china)\nsave(all_china, file = \"congress/cong_speeches/china_speech_pr.RData\")\n\nload(file = \"congress/cong_speeches/china_speech_pr.RData\")\n#fix party\nall_china_congress <- all_china\nsave(all_china_congress, file = \"data/all_china_speeches.RData\")\n\n",
    "created" : 1468356942216.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1283381311",
    "id" : "C79019C0",
    "lastKnownWriteTime" : 1457510736,
    "last_content_update" : 1457510736,
    "path" : "C:/Google Drive/Projects/Dissertation/congress/clean_speech_data.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}